language: python

#env:
#  global:
#    - TWINE_PASSWORD: ${{ secrets.PIPY_KEY }}
#    - TWINE_USER: __token__
env:
  global:
    - PKG_NAME=sequitur-g2p
    #- CIBW_SKIP="cp27-* cp34-* cp35-* *i686*"
    - CIBW_BEFORE_BUILD_LINUX=travis/before-build-linux
    - CIBW_BEFORE_BUILD_WINDOWS="dir; pwd; .\\travis\\before-build-windows"
    #- CIBW_BEFORE_BUILD_MACOS=travis/before-build-macos
    #- CIBW_TEST_COMMAND="python -c \"import $PKG_NAME; import sys; sys.exit($PKG_NAME.test())\""

matrix:
  include:
    - sudo: required
    - services: docker
    # and a mac build
    - os: osx
      language: shell
      before_install:
        - sudo mkdir -p /usr/local/man
        - sudo chown -R "${USER}:admin" /usr/local/man
    # and a windows build
    - os: windows
      language: shell
      before_install:
        - choco install python --version 3.8.0
        - export PATH="/c/Python38:/c/Python38/Scripts:$PATH"
addons:
 apt_packages:
   - swig

install:
  - pip install -r requirements.txt
  - pip install -r dev-requirements.txt

script:
  # build the wheels, put them into './wheelhouse'
  - |
    if [ "${TRAVIS_OS_NAME}" == "osx" ]; then
      brew update
      #brew upgrade gcc
      brew install swig
      gcc --version
    elif [ "${TRAVIS_OS_NAME}" == "linux" ]; then
      wget -O - https://downloads.sourceforge.net/swig/swig-4.0.1.tar.gz | tar xzf -
    elif [ "${TRAVIS_OS_NAME}" == "windows" ]; then
      choco install swig
    fi
  - python -m cibuildwheel --output-dir wheelhouse

after_success:
  # if the release was tagged, upload them to PyPI
  - if [[ $TRAVIS_TAG ]]; then python -m twine upload wheelhouse/*.whl; fi

